{"version":3,"file":"VrxTree.stories-fb0f4df7.js","sources":["../../src/components/VrxTree/TreeItem.vue","../../src/components/VrxTree/VrxTree.vue"],"sourcesContent":["<template>\n  <div data-testid=\"vrx-tree-node\" class=\"w-auto h-full flex flex-col\" :class=\"isParent ? null : 'pl-5'\">\n    <div class=\"tree-element hover:bg-gray-100 dark:hover:bg-gray-800 rounded-s\" @click=\"clickHandle\">\n      <VrxIcon :icon=\"node.children.length > 0 ? 'chevron-right': 'empty'\" :class=\"open ? 'icon-rotate' : 'icon-off'\" size=\"5\"/>\n      <VrxIcon v-if=\"node.icon\" :icon=\"node.icon\" size=\"4\"/>\n      <input\n          data-testid=\"vrx-tree-node-checkbox\"\n          v-if=\"selectable\"\n          type=\"checkbox\"\n          class=\"form-checkbox h-4 w-4 text-gray-600\"\n          v-model=\"checkValue\"\n          @click=\"selectHandle\"\n          :indeterminate.prop=\"hasChildrenChecked && !checkValue\"\n      />\n      <span>{{ props.node.text }}</span>\n    </div>\n\n    <!-- CHILDREN RECURSIVE -->\n    <TreeItem\n        v-if=\"node.children.length > 0 && open\"\n        v-for=\"child in node.children\"\n        :node=\"child\"\n        :key=\"child.id\"\n        :selectable=\"selectable\"\n        :selected=\"checkValue\"\n        :selected-nodes=\"selectedNodes\"\n        :add-node=\"addNode\"\n        :remove-node=\"removeNode\"\n        :parent-id=\"props.node.id\"\n        :siblings=\"node.children\"\n        :remove-node-by-id=\"removeNodeById\"\n        @check-clicked=\"checkClicked\"\n    />\n\n  </div>\n</template>\n\n<script setup lang=\"ts\">\n  import VrxIcon from \"@/components/VrxIcon/VrxIcon.vue\";\n  import {VrxTreeNode} from \"@/components/VrxTree/VrxTree.types.ts\";\n  import {Ref, ref, watch} from \"vue\";\n\n  const props = defineProps<{\n    node: VrxTreeNode,\n    selectable: boolean,\n    isParent?: boolean,\n    selected?: boolean,\n    selectedNodes: string[],\n    addNode: (nodeId: string) => void\n    removeNodeById: (nodeId: string, isParent?: boolean) => void\n    removeNode: (node: VrxTreeNode) => void\n    parentId: string,\n    siblings: VrxTreeNode[]\n  }>();\n\n  const open = ref(props.node.open);\n  const checkValue : Ref<boolean>= ref(props.selected || props.selectedNodes.includes(props.parentId));\n  const hasChildrenChecked = ref(false);\n\n  watch(() => props.selectedNodes,(newValue) => {\n    checkValue.value = newValue.includes(props.node.id) || newValue.includes(props.parentId) || props.selected;\n    hasChildrenChecked.value = newValue.filter((node : string) => node.includes(props.node.id)).length > 0;\n  },{immediate: true, deep: true});\n\n  watch(() => props.selected,(newValue) => {\n    checkValue.value = newValue || props.selectedNodes.includes(props.node.id);\n  },{immediate: true, deep: true});\n\n  /**\n   * Handle click for inputs and tree elements\n   * @param event\n   */\n  const clickHandle = (event: MouseEvent) => {\n    // @ts-ignore\n    if(event.target.nodeName !== \"INPUT\"){\n      open.value = !open.value;\n    }\n  }\n\n  /**\n   * Handle the click on the checkbox\n   */\n  const selectHandle = () => {\n    checkValue.value = !checkValue.value;\n    checkValue.value ? props.addNode(props.node.id) : props.removeNodeById(props.node.id, props.isParent);\n\n    if(props.node.children.length > 0){\n      props.node.children.forEach((child : VrxTreeNode) => {\n        props.removeNode(child);\n      })\n    }\n\n    if(!props.isParent){\n      checkParent();\n      checkSiblingsAndParent();\n      emit('checkClicked', props.node);\n    }\n  }\n\n\n  /**\n   * Check if all siblings are selected and if so, add the parent\n   */\n  const checkSiblingsAndParent = () => {\n    let all = true;\n    props.siblings.forEach((node : VrxTreeNode) => {\n      if(!props.selectedNodes.includes(node.id)){\n        all = false;\n      }\n    });\n    if(all){\n      props.siblings.forEach((node : VrxTreeNode) => {\n        props.removeNodeById(node.id);\n      })\n      props.addNode(props.parentId);\n    }\n  }\n\n  /**\n   * Check if parent is selected and if so, remove it and add all siblings\n   */\n  const checkParent = () => {\n    // If parent is actually selected, remove it from selected nodes and add all siblings\n    if(props.selectedNodes.includes(props.parentId) || props.selected){\n      props.removeNodeById(props.parentId, props.isParent);\n      props.siblings.forEach((sibling : VrxTreeNode) => {\n        if(sibling.id !== props.node.id)\n          props.addNode(sibling.id);\n      })\n    }\n  }\n\n  /**\n   * Emitted when a children checkbox is clicked\n   */\n  const checkClicked = () => {\n    if(props.isParent) return;\n    checkParent();\n    checkSiblingsAndParent();\n    emit('checkClicked', props.node);\n  }\n\n  const emit = defineEmits(['checkClicked']);\n\n</script>\n\n\n<style scoped>\n  .tree-element{\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    cursor: pointer;\n    gap: 5px;\n  }\n\n</style>\n","<template>\n  <div\n      class=\"flex flex-col gap-2.5 text-gray-900 dark:text-white\"\n      data-testid=\"vrx-tree\"\n  >\n    <VrxInput v-if=\"searchable\" model-value=\"test\" icon=\"search\"/>\n    <TreeItem\n        v-for=\"node in data\"\n        :parent-id=\"node.id\"\n        :node=\"node\"\n        :selectable=\"selectable ?? false\"\n        :is-parent=\"true\"\n        :key=\"node.id\"\n        :selected-nodes=\"selectedNodes as string[]\"\n        :add-node=\"addNode\"\n        :remove-node-by-id=\"removeNodeById\"\n        :remove-node=\"removeNode\"\n        :siblings=\"node.children\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\n  import TreeItem from \"@/components/VrxTree/TreeItem.vue\";\n  import {VrxTreeNode} from \"@/components/VrxTree/VrxTree.types.ts\";\n  import VrxInput from \"@/components/VrxInput/VrxInput.vue\";\n  import {ref} from \"vue\";\n\n  const props = defineProps<{\n    data: VrxTreeNode[],\n    selectable?: boolean,\n    searchable?: boolean,\n    returnsUserData?: boolean\n  }>();\n\n  /**\n   * Assigns a unique id to each node so that operations can be performed on them\n   * @param tree\n   */\n  const buildTreeWithIds = (tree: VrxTreeNode[]) => {\n    const addChildrenIds = (node: VrxTreeNode, lastId: string) => {\n      node.children.forEach((child) => {\n        child.id = lastId + '-' + Math.random().toString(16).slice(2);\n        if(child.selected) selectedNodes.value.push(child.id);\n        addChildrenIds(child, child.id);\n      })\n    }\n\n    tree.forEach((node) => {\n      node.id = Math.random().toString(16).slice(2);\n      if(node.selected) selectedNodes.value.push(node.id);\n      addChildrenIds(node, node.id);\n    })\n  }\n\n  /**\n   * Removes the selected node based on the id\n   * @param nodeId\n   * @param isParent\n   */\n  const removeNodeById = (nodeId: string, isParent : boolean = false) => {\n      if(isParent) selectedNodes.value = [];\n      if(selectedNodes.value.includes(nodeId)){\n        selectedNodes.value.splice(selectedNodes.value.indexOf(nodeId), 1);\n      }\n  }\n\n  /**\n   * Removes the selected node and removes all the children of the node\n   * @param node\n   */\n  const removeNode = (node: VrxTreeNode) => {\n    removeNodeById(node.id);\n    removeSelectedChildren(node);\n  }\n\n  /**\n   * Checks if the parent node is selected and adds it to the selected nodes\n   * @param nodeId\n   */\n  const addNode = (nodeId: string) => {\n    if(!selectedNodes.value.includes(nodeId)){\n      selectedNodes.value.push(nodeId);\n    }\n  }\n\n  /**\n   * If parent is removed, remove all the children of the parent\n   * @param node\n   */\n  const removeSelectedChildren = (node: VrxTreeNode) => {\n    selectedNodes.value.forEach((item : any) => {\n      if(item.includes(node.id)){\n        selectedNodes.value.splice(selectedNodes.value.indexOf(item), 1);\n      }\n    })\n  }\n\n  /**\n   * Returns the node based on the text\n   * @param text\n   */\n  const getNodeByText = (text: string) => {\n    let result;\n    const findText = (node: VrxTreeNode) => {\n      if(node.text === text){\n        result = node;\n        return;\n      }\n      if(node.children.length > 0){\n        node.children.forEach((child) => {\n          findText(child);\n        })\n      }\n    }\n    findText(props.data[0]);\n    return result;\n  }\n\n  /**\n   * Returns the selected nodes\n   */\n  const getSelectedNodes = () => {\n    const result : VrxTreeNode[] = [];\n\n    const traverse = (node: VrxTreeNode) => {\n      if(selectedNodes.value.includes(node.id)){\n        result.push(node);\n      }\n\n      if(node.children.length > 0){\n        node.children.forEach((child) => {\n          traverse(child);\n        })\n      }\n    }\n\n    traverse(props.data[0]);\n    const flatMapResult = result.flatMap(node => flattenTree(node));\n    return props.returnsUserData ? flatMapResult.map(node => node.userData ?? node) : flatMapResult;\n  }\n\n  /**\n   * Flattens the tree structure so that can be used as a list\n   * @param node\n   */\n  const flattenTree = (node: VrxTreeNode) => {\n    const result : VrxTreeNode [] = [];\n    const flat = (node: VrxTreeNode) => {\n      result.push(node);\n      node.children.forEach((child) => {\n        flat(child);\n      })\n    }\n    flat(node);\n    return result;\n  }\n\n  const selectedNodes = ref<String []>([]);\n  buildTreeWithIds(props.data);\n\n  defineExpose({ getSelectedNodes, getNodeByText, removeNodeById, addNode, removeNode, flattenTree });\n\n</script>\n\n<style scoped>\n\n</style>"],"names":["open","ref","props","checkValue","hasChildrenChecked","watch","newValue","node","clickHandle","event","selectHandle","child","checkParent","checkSiblingsAndParent","emit","all","sibling","checkClicked","buildTreeWithIds","tree","addChildrenIds","lastId","selectedNodes","removeNodeById","nodeId","isParent","removeNode","removeSelectedChildren","addNode","item","getNodeByText","text","result","findText","getSelectedNodes","traverse","flatMapResult","flattenTree","flat","__expose"],"mappings":"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"}